<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xzsd.pc.menu.dao.MenuDao">
    <!--<resultMap id="BaseResultMap" type="com.xzsd.pc.menu.entity.Menu" >-->
        <!--<id column="menu_id" property="menuId" jdbcType="VARCHAR" />-->
        <!--<result column="menu_name" property="menuName" jdbcType="VARCHAR" />-->
        <!--<result column="menu_path" property="menuPath" jdbcType="VARCHAR" />-->
        <!--<result column="parent_menu" property="parentMenu" jdbcType="VARCHAR" />-->
        <!--&lt;!&ndash;<result column="type" property="type" jdbcType="INTEGER" />&ndash;&gt;-->
        <!--&lt;!&ndash;<result column="level" property="level" jdbcType="INTEGER" />&ndash;&gt;-->
        <!--&lt;!&ndash;<result column="auth_code" property="authCode" jdbcType="VARCHAR" />&ndash;&gt;-->
        <!--<result column="menu_comment" property="menuComment" jdbcType="VARCHAR" />-->
        <!--<result column="is_deleted" property="isDeleted" jdbcType="INTEGER" />-->
        <!--&lt;!&ndash;<result column="id" property="id" jdbcType="VARCHAR" />&ndash;&gt;-->
        <!--&lt;!&ndash;<result column="sort_no" property="sortNo" jdbcType="INTEGER" />&ndash;&gt;-->
        <!--<result column="create_time" property="createTime" jdbcType="datetime" />-->
        <!--<result column="create_user" property="createUser" jdbcType="VARCHAR" />-->
        <!--<result column="update_time" property="updateTime" jdbcType="datetime" />-->
        <!--<result column="update_user" property="updateUser" jdbcType="VARCHAR" />-->
        <!--<result column="version" property="version" jdbcType="INTEGER" />-->
    <!--</resultMap>-->
    <!--查询全部菜单-->
    <select id="listMenus" resultType="com.xzsd.pc.menu.entity.Menu">
        select
            menu_id menuId,
            menu_name menuName,
            menu_path menuPath,
            parent_menu parentMenu,
        	version,
            menu_comment menuComment
        from t_sys_menu
        where is_delete = 0
        order by create_time
    </select>
    <!--&lt;!&ndash;获取用户菜单&ndash;&gt;-->
    <!--<select id="listUserMenus" resultMap="BaseResultMap">-->
        <!--select distinct a.menu_code,-->
		                <!--a.menu_name,-->
		                <!--a.parent_menu_code,-->
                        <!--a.auth_code,-->
		                <!--a.menu_url,-->
		                <!--a.type,-->
		                <!--a.sort_no,-->
		                <!--a.version,-->
		                <!--a.level-->
		  <!--from t_sys_menu a, t_sys_role_menu b, t_sys_user_role c-->
		 <!--where a.menu_code = b.menu_code-->
		   <!--and b.role_code = c.role_code-->
		   <!--and c.user_code = #{userCode}-->
		   <!--and a.is_deleted = 0-->
        <!--<if test="parentMenuCode != null and parentMenuCode != ''">-->
            <!--and a.parent_menu_code = #{parentMenuCode}-->
        <!--</if>-->
        <!--<if test="authCode != null and authCode != ''">-->
            <!--and a.auth_code like concat(#{authCode},'%')-->
            <!--and length(a.auth_code) > length(#{authCode})-->
        <!--</if>-->
        <!--ORDER BY SORT_NO ASC-->
		<!--&lt;!&ndash;UNION-->
		<!--SELECT C.MENU_CODE,-->
		        <!--C.MENU_NAME,-->
		        <!--C.PARENT_MENU_CODE,-->
                <!--C.AUTH_CODE,-->
		        <!--C.MENU_URL,-->
		        <!--C.TYPE,-->
		        <!--C.SORT_NO,-->
                <!--C.VERSION,-->
		        <!--C. LEVEL-->
		  <!--FROM T_SYS_MENU C, T_SYS_USER_MENU_EXTRA D-->
		 <!--WHERE C.MENU_CODE = D.MENU_CODE-->
		   <!--AND D.USER_CODE = #{userCode}-->
		   <!--AND C.DEL_FLAG = 0-->
		   <!--AND DATE_FORMAT(D.START_TIME, '%Y-%m-%d') &lt;= DATE_FORMAT(NOW(), '%Y-%m-%d')-->
		   <!--AND DATE_FORMAT(D.END_TIME, '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')-->
        <!--<if test="parentMenuCode != null and parentMenuCode != ''">-->
            <!--AND C.PARENT_MENU_CODE = #{parentMenuCode}-->
        <!--</if>-->
        <!--<if test="authCode != null and authCode != ''">-->
            <!--AND C.AUTH_CODE LIKE CONCAT(#{authCode},'%')-->
            <!--AND LENGTH(C.AUTH_CODE) > LENGTH(#{authCode})-->
        <!--</if>-->
		 <!--ORDER BY SORT_NO ASC&ndash;&gt;-->
    <!--</select>-->

    <!--&lt;!&ndash;删除角色关联菜单&ndash;&gt;-->
    <!--<delete id="deleteRoleMenu" parameterType="com.neusoft.webauth.menu.entity.Menu">-->
        <!--delete from t_sys_role_menu-->
        <!--where menu_code in-->
        <!--(select menu_code from t_sys_menu where auth_code like concat(#{authCode},'%') )-->
    <!--</delete>-->

<!--&lt;!&ndash;    <delete id="deleteAdditionMenu">-->
        <!--DELETE FROM T_SYS_USER_MENU_EXTRA-->
        <!--WHERE MENU_CODE IN-->
        <!--<foreach item="item" index="index" collection="array" open="(" separator="," close=")">-->
            <!--#{item}-->
        <!--</foreach>-->
    <!--</delete>&ndash;&gt;-->
    <!--删除菜单-->
    <update id="deleteMenu" parameterType="com.xzsd.pc.menu.entity.Menu">
        update t_sys_menu
           set is_delete = 1,
               update_time = now(),
               update_user = #{updateUser}
         where menu_id = #{menuId}
    </update>

    <!--&lt;!&ndash;删除角色菜单按钮&ndash;&gt;-->
    <!--<delete id="deleteRoleMenuBtnByMenu" parameterType="com.neusoft.webauth.menu.entity.Menu">-->
        <!--delete from t_sys_role_menu_button-->
        <!--where is_deleted = 0-->
        <!--and menu_code in-->
        <!--(select menu_code from t_sys_menu where auth_code like concat(#{authCode},'%') )-->
    <!--</delete>-->

    <!--&lt;!&ndash; 查询是否含有其他子菜单 &ndash;&gt;-->
    <!--<select id="isExitChildMenu" parameterType="com.neusoft.webauth.menu.entity.Menu" resultType="int">-->
        <!--select count(1)-->
        <!--from-->
        <!--t_sys_menu-->
        <!--where-->
        <!--is_deleted = 0-->
        <!--AND parent_menu_code = #{parentMenuCode}-->
    <!--</select>-->

    <!--&lt;!&ndash; 更新父级类型为菜单 &ndash;&gt;-->
    <!--<update id="updateParentTypes" parameterType="com.neusoft.webauth.menu.entity.Menu">-->
        <!--update t_sys_menu-->
        <!--set type = 1,-->
        <!--gmt_modified = now(),-->
        <!--last_modified_by = #{lastModifiedMy}-->
        <!--where-->
        <!--is_deleted = 0-->
        <!--AND menu_code = #{parentMenuCode}-->
    <!--</update>-->

    <!--<select id="getMaxChildrenSORT_NO" resultType="java.lang.String">-->
        <!--select max(sort_no) maxChildrenSORT_NO-->
        <!--FROM t_sys_menu-->
        <!--WHERE parent_menu_code = #{parentMenuCode}-->
    <!--</select>-->
    <!--&lt;!&ndash;获取菜单范围代码&ndash;&gt;-->
    <!--<select id="getAuthCode" resultType="string" parameterType="com.neusoft.webauth.menu.entity.Menu">-->
        <!--select case-->
		         <!--when auth_code is not null then-->
		          <!--concat(#{parentAuthCode},-->
		                 <!--lpad(substr(max(auth_code) from length(auth_code) - 2 for-->
		                             <!--length(auth_code)) + 1,-->
		                      <!--3,-->
		                      <!--0))-->
		         <!--else-->
		          <!--concat(#{parentAuthCode}, '000')-->
		       <!--end auth_code-->
		  <!--from t_sys_menu-->
		 <!--where parent_menu_code = #{parentMenuCode}-->
    <!--</select>-->
    <!--新增菜单-->
    <insert id="insertMenu" parameterType="com.xzsd.pc.menu.entity.Menu">
        insert into t_sys_menu
           (menu_id,
            menu_name,
            menu_path,
            parent_menu,
            is_delete,
            menu_comment,
            create_time,
            create_user,
            update_time,
            update_user
          ) values (
            #{menuId},
            #{menuName},
            #{menuPath},
            #{parentMenu},
            #{isDelete},
            #{menuComment},
            now(),
            #{createUser},
            now(),
            #{updateUser})
    </insert>

    <!--&lt;!&ndash; 新增子菜单，更新父级菜单类型为目录 &ndash;&gt;-->
    <!--<update id="updateParentType" parameterType="com.neusoft.webauth.menu.entity.Menu">-->
        <!--update t_sys_menu-->
        <!--set type = 2,-->
        <!--gmt_modified = NOW(),-->
        <!--last_modified_by = #{createBy}-->
        <!--where-->
        <!--is_deleted = 0-->
        <!--and menu_code = #{parentMenuCode}-->
    <!--</update>-->
    <!--修改菜单信息-->
    <update id="updateMenu" parameterType="com.xzsd.pc.menu.entity.Menu">
        update t_sys_menu
           set menu_name    = #{menuName},
               menu_path     = #{menuPath},
               version      = version + 1,
               menu_comment = #{menuComment},
               update_time = now(),
               update_user = #{updateUser}
         where menu_id = #{menuId}
    </update>
    <!--根据角色代码查询已授权的菜单信息-->
    <select id="listRoleMenusBy" resultType="com.xzsd.pc.menu.entity.Menu">
        select  menu_id menuId,
        menu_name menuName,
        menu_path menuPath
        from t_sys_menu
        where is_delete = 0
        <if test="roleCode == 2">
            and role = #{roleCode}
        </if>
    </select>
    <!--查询菜单详情-->
    <select id="getMenu" resultType="com.xzsd.pc.menu.entity.Menu" parameterType="java.lang.String">
        select menu_name menuName,
        menu_path menuPath,
        menu_comment menuComment,
        version
        from t_sys_menu
        where menu_id = #{menuId}
    </select>
</mapper>